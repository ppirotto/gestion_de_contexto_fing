<?xml version="1.0" encoding="ISO-8859-1" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/masterTemplate.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="title">Crear Situación</ui:define>
	<ui:define name="body">
		
			<!-- 			<f:facet name="header">Crear Situación</f:facet> -->

			<h:form id="form">
				<p:growl autoUpdate="true" life="6000" showDetail="true"
					escape="true" showSummary="true" />
				<p:wizard flowListener="#{situationBean.onFlowProcess}"
					backLabel="Atrás" nextLabel="Siguiente">
					<p:tab id="situationTab" title="Situación">
						<p:panel>
							<f:facet name="header">Crear Situación</f:facet>
							<p:panelGrid columns="2">
								<p:outputLabel>
						Nombre de la situación
					</p:outputLabel>
								<p:inputText size="25" value="#{situationBean.name}" validatorMessage="El nombre debe empezar con mayúscula y debe ser alfanúmerico"
									required="true" label="Nombre de la situación" >
									 <f:validateRegex pattern="^[A-Z][a-zA-Z_]+$" />
									</p:inputText>
								<p:outputLabel>
						Descripción
					</p:outputLabel>
								<p:inputTextarea scrollHeight="2" autoResize="false"
									style="width:225px" value="#{situationBean.description}"
									required="true" validatorMessage="Falta descripción"
									label="Descripción" />

								<p:outputLabel>
						Duración (milisegundos)
					</p:outputLabel>
								<p:inputText id="duration" size="16"
									value="#{situationBean.duration}" label="Duración"
									validatorMessage="Duración mayor a 0">
									<f:validateDoubleRange minimum="1" />
								</p:inputText>

							</p:panelGrid>
						</p:panel>
					</p:tab>
					<p:tab id="contextTab" title="Contexto">
						<p:panel>
							<f:facet name="header">Definición de data contextual</f:facet>
							<h:panelGrid columns="3" columnClasses="topAligned">
								<p:panel>
									<f:facet name="header">Input</f:facet>


									<h:panelGrid columns="2">
										<h:panelGrid columns="1">
											<p:outputLabel value="Fuente de contexto" />

											<p:selectOneMenu id="selectSituation" autoupdate="true"
												required="true"
												requiredMessage="Seleccione fuente de conexto"
												style="width:180px"
												value="#{situationBean.selectedContextSource}" effect="fade">
												<f:selectItem itemLabel="Seleccione una" itemValue="" />
												<f:selectItems value="#{situationBean.contextSources}"
													var="contSource" itemLabel="#{contSource}"
													itemValue="#{contSource}" />
											</p:selectOneMenu>
											--------------------------------------
											<p:dataTable id="dataTable" var="dat" style="width:180px"
												value="#{situationBean.contextDataList}" scrollable="true"
												scrollHeight="130"
												selection="#{situationBean.selectedInputData}"
												rowKey="#{dat}">

												<p:column selectionMode="multiple"
													style="width:16px;text-align:center" />
												<p:column headerText="ContextData">
													<h:outputText value="#{dat}" />
												</p:column>

											</p:dataTable>

										</h:panelGrid>
										<p:panel>
											<f:facet name="header">Seleccionados	</f:facet>

											<p:tree id="tree" value="#{situationBean.root}" var="node"
												dynamic="true"
												style="width:190px;height:160px;overflow: auto;">

												<p:treeNode>
													<h:outputText value="#{node}" />
												</p:treeNode>
											</p:tree>
										</p:panel>


									</h:panelGrid>
									<f:facet name="footer">
										<p:commandButton value="Asignar" update="tree"
											action="#{situationBean.createDatumForInput()}" />
									</f:facet>

								</p:panel>
								<p:spacer width="30px"></p:spacer>
								<p:panel>
									<f:facet name="header">Output</f:facet>
									<p:dataTable id="dataTableOutput" var="dat" style="width:220px"
										value="#{situationBean.contextDataList}" scrollable="true"
										scrollHeight="274"
										selection="#{situationBean.selectedOutputData}"
										rowKey="#{dat}">

										<p:column selectionMode="multiple"
											style="width:16px;text-align:center" />
										<p:column headerText="ContextData">
											<h:outputText value="#{dat}" />
										</p:column>

									</p:dataTable>

								</p:panel>
							</h:panelGrid>


						</p:panel>
					</p:tab>


					<p:tab id="ruleTab" title="Regla">
						<p:panel header="Definir la regla: #{situationBean.name}">
							<h:panelGrid columns="2" columnClasses="topAligned ">
								<h:panelGrid columns="1">


									<p:panel style="height:300px" header="Reglas:">

										<p:selectOneListbox id="ruleSelectOneListbox"
											value="#{situationBean.selectedRule}"
											converter="ruleConverterSituation" style="width:210px">
											<f:ajax listener="#{situationBean.selectedRuleChanged}"
												render=":form:codeMirror" />
											<f:selectItems value="#{situationBean.versionRules.rules}"
												var="rule" itemLabel="#{rule.name}" itemValue="#{rule}" />
										</p:selectOneListbox>

									</p:panel>
								</h:panelGrid>
								<p:panel style="min-width:600px;min-height:300px;">
									<pe:codeMirror id="codeMirror" mode="javascript"
										readOnly="#{situationBean.isReadOnly()}" theme="eclipse"
										value="#{situationBean.selectedRule.drl}" lineNumbers="true"
										matchBrackets="true" lineWrapping="true" />

								</p:panel>



							</h:panelGrid>

							<f:facet name="footer">

								<p:commandButton value="Guardar Regla"
									 />
								<p:commandButton value="Crear Situación"
									action="#{situationBean.crearSituacion()}"
									styleClass="ui-priority-primary" />
							</f:facet>
						</p:panel>
					</p:tab>
				</p:wizard>


			</h:form>

		
	</ui:define>
	<ui:define name="menuIzq">
		<ui:include src="/menu.xhtml" />
	</ui:define>
</ui:composition>