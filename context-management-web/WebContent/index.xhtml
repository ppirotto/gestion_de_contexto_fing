<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">


<h:head>
	<title><ui:insert name="title">CEP Management</ui:insert></title>
<!-- 	<script name="jquery/jquery.js" library="primefaces"></script> -->

	<h:outputStylesheet library="primefaces-extensions"	name="codemirror/mode/tiki.css" />

</h:head>


<h:body>
<p:layout style="min-width:400px;min-height:200px;" fullPage="true">
 	<p:layoutUnit position="north" resizable="false" size="90" minSize="90" maxSize="200">
 		<h:form>
	 		<h:panelGrid columns="8" style="margin-bottom:10px" cellpadding="5">
		        <p:outputLabel for="versionSelectOneMenu" value="Seleccionar version base:" />
		        <p:selectOneMenu id="versionSelectOneMenu" value="#{rulesBean.selectedVersion}" converter="versionConverter" style="width:125px">
		        	<f:ajax listener="#{rulesBean.selectedVersionChanged}" render=":ruleForm:ruleSelectOneListbox"/>
		        	
		            <f:selectItems value="#{rulesBean.res.versions}" var="version" itemLabel="#{version.versionNumber}" itemValue="#{version}"/>
		        </p:selectOneMenu>
		        <p:outputLabel value="Version activa: " />
		        <p:outputLabel value="#{rulesBean.activeVersion}" />
		        <p:spacer width="100" height="10" />
		        <p:outputLabel for="deploySelectOneMenu" value="Deployar version:" />
		        <p:selectOneMenu id="deploySelectOneMenu" value="#{rulesBean.versionToDeploy}" converter="versionConverter" style="width:125px">
		            <f:selectItems value="#{rulesBean.res.versions}" var="version2" itemLabel="#{version2.versionNumber}" itemValue="#{version2}"/>
		        </p:selectOneMenu>
		        <p:commandButton value="Deploy!!!" icon="ui-icon-check" actionListener="#{rulesBean.deployVersion}" title="Deployar version seleccionada"/>			        
	         </h:panelGrid>
         </h:form>
    </p:layoutUnit>
    <p:layoutUnit position="west" resizable="false" size="300" minSize="40" maxSize="300">
        <h:form id="ruleForm">
	        <p:selectOneListbox id="ruleSelectOneListbox" value="#{rulesBean.selectedRule}" converter="ruleConverter" style="width:250px">
	        	<f:ajax listener="#{rulesBean.selectedRuleChanged}" render=":codeMirrorForm:codeMirror"/>
	            <f:selectItems value="#{rulesBean.selectedVersion.rules}" var="rule" itemLabel="#{rule.name}" itemValue="#{rule}"/>
	        </p:selectOneListbox>
         </h:form>
    </p:layoutUnit>
 
    <p:layoutUnit position="center"  style="width: 500px;" fullPage="true">

		<h:form id="codeMirrorForm">
			<pe:codeMirror id="codeMirror" style="min-width:400px;min-height:1000px;height:999px;" mode="javascript" theme="eclipse" value="#{rulesBean.selectedRule.rule}" lineNumbers="true" matchBrackets="true" lineWrapping="true"/> 
		
			<br />
			<div align="right">
				<p:commandButton value="Guardar regla" title="Guarda regla en la sesion" icon="ui-icon-check" actionListener="#{rulesBean.saveRuleAction}" />
			</div>
			<p:separator />
			
			<div align="right">
				<p:commandButton value="Crear nueva version!" update="display" oncomplete="PF('dlg').show()" icon="ui-icon-check" actionListener="#{rulesBean.saveRuleAction}" title="Crea una nueva version con las reglas nuevas versiones de las reglas"/>
			</div>
			<p:dialog header="Creando nueva version..." modal="false" showEffect="bounce" widgetVar="dlg" resizable="false">
				<p:panelGrid columns="2" id="display" style="margin-bottom:10px" cellpadding="5">
					<h:outputText value="Se creara una nueva version. Elegir nombre deseado." />
					<h:inputText  value="#{rulesBean.newVersionName}" />
					<p:commandButton value="Crear nueva version!" icon="ui-icon-check" actionListener="#{rulesBean.createVersion}" oncomplete="PF('dlg').hide()" title="Crear nueva version!"/>
				</p:panelGrid>
			</p:dialog>
		</h:form>
	</p:layoutUnit>
</p:layout>

	
	
</h:body>
</html>